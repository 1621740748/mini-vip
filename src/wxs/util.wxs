// 日期格式化
function formatDate(value) {
  if (typeof value == "string") {
    value = getDate(value);
  }
  var year = value.getFullYear() + '年';
  var month = (value.getMonth() + 1) + '月';
  var date = value.getDate() + '日';

  var hours = value.getHours();
  var minutes = value.getMinutes();

  var minutes_str = '';
  if (minutes < 10) {
    minutes_str = '0' + minutes;
  } else {
    minutes_str = minutes;
  } 

  var hours_str = '';
  if (hours <= 12) {
    hours_str = '上午' + hours
  } else if (hours <= 18) {
    hours_str = '下午' + (hours - 12);
  } else {
    hours_str = '晚上' + (hours - 12);
  }
  return year + month + date + ' ' + hours_str + ':' + minutes_str;
}

// 图片地址转换
function formatImageUrl(src, baseUrl) {
  if (getRegExp("^\w+:\/\/").test(src)) {
    // http:// 或 wxfile:// 等完整路径直接返回
    return src;
  }
  else if(src == "load_faild"){
    return "/images/faild.png";
  }
  else if(src){
    return baseUrl + "/api/files/images/" + src;
  }
  else{
    return "/images/empty.png";
  }
}


// 头像地址转换
function formatAvatarImageUrl(src, baseUrl) {
  console.log("===src, baseUrl===",src, baseUrl)
  if (getRegExp("^\w+:\/\/").test(src)) {
    // http:// 或 wxfile:// 等完整路径直接返回
    return src;
  }
  else if(src != "load_faild"){
    return baseUrl + "/api/files/images/" + src;
  }
  else{
    return "/images/avatar.png";
  }
}

// 会员卡背景地址转换
function formatCardBgImageUrl(src, baseUrl) {
  if (getRegExp("^\w+:\/\/").test(src)) {
    // http:// 或 wxfile:// 等完整路径直接返回
    return src;
  }
  else if(src != "load_faild"){
    return baseUrl + "/api/files/images/" + src;
  }
  else{
    return null;
  }
}

// 视频地址转换
function formatVideoUrl(src, baseUrl) {
  if(src){
    if (getRegExp("^\w+:\/\/").test(src)){
      return src;
    }else {
      return baseUrl + "/api/files/videos/" + src;
    }
  }
  else{
    return "/images/empty.png";
  }
}

// 文章图片模板
function getEmptyImageUrl(type) {
  var url = "https://www-steedos-com.oss-cn-beijing.aliyuncs.com/apps/vip/covers/"
  switch (type) {
    case "announcements":
      return url = url + "announcements.jpg";
      break;
    case "about":
      return url = url + "about.jpg";
      break;
    case "news":
      return url = url + "news.jpg";
      break;
    case "course":
      return url = url + "course.jpg";
      break;
    case "help":
      return url = url + "help.jpg";
      break;
    case "jobs":
      return url = url + "jobs.jpg";
      break;
    default : 
      return url = url + "news.jpg";
      break; 
  }
  return url;
}

function transformFieldValue(field, value){
  if(!value){
    return "";
  }

  if(field.type === 'select'){
    if(field.multiple){
      var val = [];
      field.options.forEach(function(_o){
        if (value.indexOf(_o.value) > -1) {
          val.push(_o.label)
        }
      })
      return val.join(",");
    }else{
      var val = '';
      field.options.forEach(function(_o){
        if (value === _o.value) {
          val = _o.label
        }
      })
      return val;
    }
  }else if(field.type === 'location'){
     return value.address
  }else if((field.type === 'lookup' || field.type === 'master_detail') && field.reference_to){
    if(field.multiple){
      var val = [];
      value.forEach(function(v){
        val.push(v.name);
      })
      return val.join(",");
    }else{
      return value.name
    }
  }else if(field.type === 'datetime'){
    if(typeof value == "string"){
      value = getDate(value);
    }
    var year = value.getFullYear() + '年';
    var month = (value.getMonth() + 1) + '月';
    var date = value.getDate() + '日';

    var hours = value.getHours();
    var hours_str = '';
    if(hours <= 12){
      hours_str = '上午' + hours
    }else if(hours <= 18){
      hours_str = '下午' + (hours - 12);
    }else{
      hours_str = '晚上' + (hours - 12);
    }

    return year + month + date + ' ' + hours_str + ':' + value.getMinutes()
  }
  return value
}


module.exports = {
  formatDate: formatDate,
  formatImageUrl: formatImageUrl,
  formatAvatarImageUrl: formatAvatarImageUrl,
  formatCardBgImageUrl: formatCardBgImageUrl,
  formatVideoUrl: formatVideoUrl,
  getEmptyImageUrl:getEmptyImageUrl,
  transformFieldValue: transformFieldValue
}
